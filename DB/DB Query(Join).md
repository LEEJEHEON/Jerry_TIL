# DB Query(Join)
- DB 쿼리에서 조인(JOIN)은 두 개 이상의 테이블을 서로 연결하여 관련된 데이터를 하나의 결과 집합으로 조회하는 방법
- 조인은 여러 테이블에서 데이터를 결합해 필요한 정보를 얻기 위해 사용

## JOIN 종류 

### INNER JOIN (내부 조인)
- 두 테이블에서 조인 조건에 맞는(공통된 값이 있는) 행들만 결과에 포함
- 조건에 맞지 않는 행은 제외됩니다. 가장 일반적으로 사용

### LEFT JOIN (왼쪽 외부 조인)
- 왼쪽 테이블의 모든 행을 결과에 포함하며, 오른쪽 테이블과 조인 조건이 맞는 경우 오른쪽 테이블의 데이터도 포함
- 오른쪽에 일치하는 데이터가 없으면 NULL로 표사

### RIGHT JOIN (오른쪽 외부 조인)
- RIGHT JOIN은 LEFT JOIN의 반대 개념으로, 오른쪽 테이블의 모든 행을 포함하고 왼쪽 테이블과의 조인 조건에 맞는 데이터를 보여줌

## FULL JOIN (전체 외부 조인)
- 양쪽 테이블 모두에서 조인 조건에 맞는 모든 행을 포함하며, 어느 한쪽에만 데이터가 있는 경우에도 모두 결과에 포함
- 양쪽에 일치하는 데이터가 없으면 NULL

### CROSS JOIN (카티션 곱)
- 두 테이블의 모든 가능한 조합을 만들어 결과를 반환
- 조건이 없어서 결과가 많아질 수 있어 주로 주의해서 사용

## 사용하는 이유
- 데이터베이스는 중복과 공간 낭비를 줄이고 무결성을 유지하기 위해 여러 테이블로 데이터를 분리 저장
- 조인은 이렇게 분리된 테이블들에서 연관된 데이터를 결합해 필요한 정보를 효율적으로 추출

## 기본 구문 예시
1. ON 절 
```sql
SELECT columns
FROM table1
INNER JOIN table2
ON table1.key = table2.key;
```
- ON 절은 조인 조건을 지정하며, 두 테이블에서 어떤 컬럼을 기준으로 연결할지 명시한다. 

2. WHERE 절 
```sql
SELECT a.column1, b.column2
FROM tableA a, tableB b
WHERE a.key = b.key;
```
- FROM 절에 여러 테이블을 적고, WHERE 절에서 조인할 컬럼 간 조건을 작성하여 조인하는 방식

> 현대 SQL에서는 ON절을 사용하는 JOIN 방식이 가독성, 명확성, 최적화 측면에서 권장 


## ❓ QnA

### 🙋‍♂️ JOIN은 상당한 시간이 걸릴 수 있기에 내부적으로 다양한 구현 방식을 사용하고 있습니다. 그 예시에 대해 설명해 주세요.
💁 데이터베이스 엔진은 내부적으로 다양한 최적화된 알고리즘과 구현 방식을 사용  <br><br>
주요 JOIN 처리 알고리즘 
1. Nested Loop Join (중첩 루프 조인)
    - 가장 기본적이고 오래된 방식입니다.
    - 한 테이블의 각 행마다 다른 테이블을 순차적으로 탐색하는 방식으로, 두 테이블의 행 수를 각각 N, M이라 하면 최악의 경우 N×M번 비교를 수행
    - 작은 데이터셋이나 인덱스가 잘 걸린 상황에서 효과적

2. Hash Join (해시 조인)
    - 한쪽 테이블(주로 작은 테이블)의 조인 키를 기준으로 해시 테이블을 만들고, 다른 테이블의 각 행 키와 매칭하여 빠르게 조인하는 방식
    - 대용량 데이터셋에서 Nested Loop Join보다 효율적이며, 메모리 사용량에 따라 성능이 좌우될 수 있음

3. Sort Merge Join (병합 정렬 조인)
    - 두 테이블을 조인 키 기준으로 정렬한 뒤, 병합하듯이 조인하는 방식
    - 양쪽 데이터가 정렬되어 있거나 정렬 비용이 크지 않을 때 효과적이며, 대량의 데이터에 적합

### 🙋‍♂️ 입력한 쿼리에서 어떤 구현 방식을 사용하는지는 어떻게 알 수 있나요?
💁 어떤 JOIN 구현 방식을 사용하는지 확인하려면, SQL 실행 계획(Execution Plan)을 조회하는 방법이 가장 정확
- 실행 계획 확인 방법
```sql
EXPLAIN
SELECT *
FROM tableA a
INNER JOIN tableB b ON a.key = b.key;
```
쿼리 앞에 EXPLAIN을 붙여 실행하면, 해당 쿼리가 어떻게 처리될지 내부 계획을 볼 수 있음.

### 🙋‍♂️ 앞 질문들을 통해 인덱스의 중요성을 알 수 있었는데, 그렇다면 JOIN의 성능도 인덱스의 유무의 영향을 받나요?
💁 JOIN의 성능은 인덱스 유무에 크게 영향을 받는다.
- 조인에 사용되는 컬럼들에 인덱스가 있다면, 데이터베이스는 해당 컬럼을 기준으로 더 빠르게 필요한 데이터를 찾을 수 있어 조인 속도가 크게 향상
1. 조인 조건 컬럼에 인덱스 생성
    - 조인에 참여하는 모든 테이블에서 조인 키(컬럼)에 인덱스가 있으면, 데이터 탐색이 빨라져 조인 실행 속도가 개선
2. 작은 테이블과 큰 테이블의 조합 최적화
    - 보통 작은 테이블의 인덱스를 잘 활용하여 먼저 접근하고, 큰 테이블과 조인하는 방식이 성능에 유리
3. 인덱스 부재시
    - 인덱스가 없으면 데이터베이스는 테이블 전체를 스캔해야 하므로(풀 테이블 스캔), 조인에 시간이 많이 걸릴 수 있음
4. 조인 타입별 영향 차이
    - INNER JOIN, LEFT JOIN 등 모든 조인에서 인덱스는 성능 향상에 도움 되나, FULL OUTER JOIN이나 CROSS JOIN 등에서는 인덱스가 성능 개선에 상대적으로 덜 효과적
5. 필터링 조건과 결합 시 더 효과적
    - 조인뿐만 아니라 WHERE 절 필터링 조건이 인덱스에 의해 잘 활용되면 전체 쿼리 성능이 함께 좋아짐

### 🙋‍♂️ 3중 조인 부터는 동작 방식이 약간 바뀝니다. 어떻게 동작하는지, 그리고 그 방식이 성능에 어떠한 영향을 주는지 설명해 주세요.
💁 기본적으로 3중 조인은 2개 테이블 단위 조인을 연속으로 수행합니다. 예를 들어, 테이블 A와 B를 먼저 조인하고, 그 결과를 다시 테이블 C와 조인하는 식
- 옵티마이저는 조인의 순서(조인 순서 결정)를 신중히 선택하여 전체 쿼리 비용을 최소화하려 시도
- 조인 순서가 잘못되면 불필요한 데이터가 많이 생성되어 성능 문제를 초래
- 조인 수행 시, Nested Loop Join, Hash Join, Sort Merge Join 중 적합한 알고리즘을 각 단계별로 선택하여 실행
- 일부 DBMS는 중간 결과를 임시 저장하는 방식(임시 테이블 생성)을 사용하기도 함
<br><br>
<b>3중 조인이 성능에 미치는 영향</b>
- 2중 조인 대비 최적화가 복잡해져서, 조인 순서와 연산 방식에 따라 성능 차이가 크게 발생할 수 있음
- 인덱스가 없는 컬럼이나 큰 테이블이 포함된 조인이 많아질수록 중간 처리 데이터가 폭증하여 실행 시간이 길어짐
- 조인 순서를 적절히 설정하고, 인덱스를 잘 활용하면 3중 조인도 효율적으로 처리함
- 반대로 조인 조건이 복잡하거나 불필요한 조인이 많으면 성능 저하가 심해짐

### 🙋‍♂️ merge join 이랑 hash join에 차이 
💁

| 구분          | Merge Join                   | Hash Join                   |
|---------------|-----------------------------|-----------------------------|
| 동작 방식      | 정렬 후 병합                 | 해시 테이블 생성 및 조회     |
| 지원 조인 조건 | 동등, 범위 비교 가능          | 동등 조인만 가능              |
| 효율 조건      | 인덱스 혹은 정렬된 데이터 있을 때 | 인덱스 없어도 대용량에 적합   |
| 메모리 사용량  | 적음                        | 많이 사용 가능               |
| 정렬 비용      | 있을 수 있음                 | 없음                        |
| 사용 사례      | 범위 조건, 정렬된 데이터 조인 | 큰 테이블 동등 조인           |

### 🙋‍♂️  WHERE절에 조건을 넣는거랑 ON절 후 AND를 통해 조건을 넣으면 성능 측면에서 어떤 차이가 있는지
💁   
1) INNER JOIN에서는 차이가 거의 없음
- ON절이든 WHERE절이든 논리적으로 같은 조건으로 처리되기 때문에 실행 계획이나 성능 차이
2) OUTER JOIN에서는 큰 차이 발생
- ON절 조건은 조인 연산 중에 조건 필터링이 수행되어 불필요한 데이터 조인 자체를 줄일 수 있음
- 반면 WHERE절 조건은 조인이 완료된 후 결과에 필터를 적용하는 형태라, 조인 결과가 더 커질 수 있어 성능 저하가 발생

